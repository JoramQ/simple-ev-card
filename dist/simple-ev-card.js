class t extends HTMLElement{constructor(){super(...arguments),this._prevBattery=null,this._prevRange=null,this._prevIsCharging=null,this._prevStatus=null,this._prevChargerStatus=null,this._carEventFetched=!1,this._carEvent=null}_getLocationBooleans(t,e,a){const n=e=>{if("boolean"==typeof e)return e;if("string"==typeof e){const a=t.states[e];if(a)return"on"===a.state||"true"===a.state||"1"===a.state;if("true"===e)return!0;if("false"===e)return!1}};let s=n(e.is_home),r=n(e.is_away),i=n(e.is_driving);if(void 0===s||void 0===r||void 0===i){const a=e.car_location_entity?t.states[e.car_location_entity]:void 0;a&&a.state&&(void 0===s&&(s="home"===a.state),void 0===r&&(r="not_home"===a.state),void 0===i&&(i=!s&&!r))}return void 0===s&&void 0===r&&void 0===i&&a&&(s=!0,r=!1,i=!1),{isHome:s??!1,isAway:r??!1,isDriving:i??!1}}setConfig(t){this.config=t;const e=["car_battery_entity","car_cruising_range_entity","charger_connected_entity"].filter((t=>!this.config[t]));if(e.length)throw new Error("Missing required config keys: "+e.join(", "));this.innerHTML='\n      <ha-card>\n        <style>\n          .carcard_container {\n            position: relative;\n            width: 100%;\n            display: flex;\n            flex-direction: column;\n            padding-bottom: 10px;\n          }\n          .carcard_image {\n            width: 100%;\n            height: auto;\n            display: block;\n          }\n          .carcard_overlay {\n            position: absolute;\n            top: 8px;\n            left: 12px;\n            padding: 4px 12px;\n            font-size: var(--ha-card-header-font-size, 24px);\n            font-family: var(--ha-card-header-font-family, inherit);\n            color: var(--ha-card-header-color,var(--primary-text-color));\n            letter-spacing: -0.012em;\n            z-index: 2;\n          }\n\n          .carcard_battery_bar_container {\n            position: relative;\n            margin: 10px;\n            height: 30px;\n            background-color: rgba(0,0,0,0.25);\n            border-radius: 15px;\n            overflow: hidden;\n          }\n          .carcard_battery_bar_background {\n            position: absolute;\n            top: 0;\n            left: 0;\n            height: 100%;\n            width: 0%;\n            background-color: red;\n            transition: width 0.3s ease, background-color 0.3s ease;\n            border-radius: 15px 0 0 15px;\n          }\n          .carcard_battery_bar_text {\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            color: white;\n            font-weight: bold;\n            font-size: 16px;\n            text-shadow: 1px 1px 2px black;\n          }\n          \n          .charge_button {\n            margin: 10px;\n            padding: 7px;\n            border: none;\n            border-radius: 10px;\n            font-size: 14px;\n            cursor: pointer;\n            background-color: #2196F3;\n            color: white;\n            box-shadow: 0 2px 5px rgba(0,0,0,0.3);\n            transition: background-color 0.3s ease;\n          }\n          .charge_button:hover {\n            background-color: #1976D2;\n          }\n          #car_event {\n            text-align: center;\n          }\n          .hidden {\n            display: none !important;\n          }\n          svg .green {\n            fill: #62e027ff !important;\n          }\n          svg .svg_charger,\n          svg .svg_parking,\n          svg .svg_carbody,\n          svg .svg_carhandles,\n          svg .svg_carwheels,\n          svg .svg_driver,\n          svg .svg_moving,\n          svg .svg_cable {\n            fill: var(--primary-text-color);\n          }\n          .bottom_row {\n            display: flex;\n            align-items: center;\n          }\n          #charger_status {\n            flex: 1;      /* takes up remaining space */\n            margin-left: 20px;\n          }\n          .actions {\n            margin-left: auto;  /* pushes the button to the right */\n          }\n        </style>\n        <div class="carcard_container">\n          <svg viewBox="0 0 400 200" preserveAspectRatio="none" class="carcard_image">\n            <path class="svg_charger body hidden" d="M0,0 L35,0 L41,3 L46,9 L47,12 L47,131 L52,131 L54,133 L54,144 L52,146 L-18,146 L-19,145 L-19,133 L-16,131 L-12,131 L-12,11 L-8,5 L-3,1 Z M1,6 L-5,10 L-7,15 L-7,131 L41,131 L41,13 L36,7 L34,6 Z M-13,137 L-13,141 L48,141 L48,137 Z " transform="translate(331,47)"/>\n            <path class="svg_charger display_inside hidden" style="fill: transparent" d="M0,6 L3,35 L26,35 L26,6 Z " transform="translate(334,64)"/>\n            <path class="svg_charger display hidden" d="M0,0 L28,0 L32,4 L32,37 L30,40 L27,41 L1,41 L-3,38 L-3,3 Z M3,6 L3,35 L26,35 L26,6 Z " transform="translate(334,64)"/>\n            <path class="svg_charger icon hidden" d="M0,0 L2,0 L1,7 L5,7 L4,12 L-1,18 L-3,17 L-2,11 L-6,11 L-5,6 Z " transform="translate(349,76)"/>\n            <path class="svg_charger connector hidden" d="M0,0 L7,0 L11,4 L12,6 L12,15 L8,20 L-1,20 L-5,16 L-5,4 Z M2,6 L1,7 L1,14 L5,15 L6,14 L6,7 Z " transform="translate(345,116)"/>\n            \n            <path class="svg_parking hidden" style="scale:0.8" d="M0,0 L52,0 L56,4 L57,6 L57,56 L54,61 L51,63 L29,64 L29,81 L28,91 L24,88 L23,63 L0,63 L-4,59 L-5,56 L-5,5 Z M5,4 L0,7 L0,55 L2,58 L49,58 L52,55 L52,8 L50,5 L45,4 Z " transform="translate(322,18)"/>\n            <path class="svg_parking hidden" style="scale:0.8" d="M0,0 L15,0 L22,3 L25,6 L26,14 L23,19 L19,22 L7,23 L6,34 L0,34 L-1,1 Z M7,6 L6,7 L6,16 L7,17 L15,17 L19,13 L18,8 L16,6 Z " transform="translate(337,32)"/>\n            \n            <path class="svg_carbody" d="M0,0 L36,0 L58,1 L78,4 L92,11 L105,21 L116,29 L130,34 L134,39 L134,63 L133,81 L132,90 L129,99 L124,103 L116,105 L107,106 L102,115 L96,121 L94,121 L94,123 L119,123 L120,127 L119,128 L-151,128 L-152,123 L-108,123 L-108,121 L-113,119 L-119,111 L-120,106 L-140,105 L-150,103 L-154,99 L-155,86 L-155,74 L-152,69 L-148,59 L-143,54 L-135,49 L-117,43 L-91,37 L-78,34 L-66,26 L-49,15 L-30,5 L-19,2 Z M6,6 L-11,7 L-25,10 L-41,18 L-56,27 L-74,39 L-90,43 L-120,50 L-133,55 L-133,56 L-114,57 L-114,62 L-120,69 L-127,73 L-148,74 L-149,75 L-149,90 L-147,97 L-140,99 L-122,99 L-120,86 L-116,78 L-107,70 L-99,67 L-85,67 L-76,71 L-70,76 L-65,84 L-63,91 L-62,99 L10,99 L10,63 L11,48 L-63,48 L-62,43 L-51,34 L-32,22 L-21,17 L-4,14 L47,14 L62,16 L72,21 L78,26 L83,34 L83,47 L78,65 L91,69 L99,75 L103,80 L107,89 L109,99 L119,98 L124,96 L126,92 L128,67 L129,61 L129,44 L126,39 L113,34 L103,27 L87,15 L76,10 L56,7 L32,6 Z M2,19 L-15,21 L-26,25 L-41,34 L-43,37 L-36,38 L-35,43 L-8,43 L9,42 L14,24 L14,19 Z M23,19 L22,20 L20,37 L20,42 L53,42 L60,41 L62,27 L62,22 L56,20 L41,19 Z M67,25 L66,26 L65,41 L77,41 L78,36 L72,28 Z M39,47 L16,48 L14,62 L14,99 L48,99 L51,85 L56,77 L64,70 L73,66 L76,58 L78,51 L78,47 Z M-141,61 L-144,64 L-145,68 L-144,69 L-131,69 L-124,66 L-120,63 L-120,61 Z M-95,75 L-105,79 L-111,86 L-113,91 L-113,103 L-110,109 L-102,116 L-96,118 L-88,118 L-78,113 L-74,108 L-71,100 L-71,93 L-74,85 L-79,80 L-85,76 Z M76,75 L68,78 L60,85 L57,93 L57,100 L61,110 L68,116 L74,118 L82,118 L90,115 L97,107 L99,102 L99,91 L95,83 L89,78 L81,75 Z M-64,106 L-70,116 L-77,122 L-77,123 L63,123 L58,118 L52,110 L50,106 Z " transform="translate(177,65)"/>\n            <path class="svg_carbody" d="M0,0 L14,0 L18,3 L19,6 L19,16 L17,20 L13,22 L1,22 L-4,18 L-5,16 L-5,5 Z M1,6 L1,14 L3,16 L12,16 L13,15 L13,7 L12,6 Z " transform="translate(273,110)"/>\n            \x3c!--- doorhandles --\x3e\n            <path class="svg_carhandles" d="M0,0 L13,0 L14,3 L13,5 L0,5 L-1,1 Z " transform="translate(234,120)"/>\n            <path class="svg_carhandles" d="M0,0 L14,0 L15,4 L14,5 L0,5 L-1,2 Z " transform="translate(167,121)"/>\n            \x3c!--- wieldop --\x3e\n            <path class="svg_carwheels" d="M0,0 L9,0 L15,4 L17,7 L18,14 L15,21 L10,25 L3,26 L-4,23 L-8,17 L-8,8 L-5,3 Z M2,6 L-2,10 L-1,17 L1,19 L8,19 L11,16 L11,10 L7,6 Z " transform="translate(80,149)"/>\n            <path class="svg_carwheels" d="M0,0 L8,0 L14,4 L17,10 L16,19 L11,24 L6,26 L-1,25 L-7,20 L-9,11 L-5,3 Z M2,6 L-2,9 L-2,16 L1,19 L5,20 L10,17 L11,11 L6,6 Z " transform="translate(251,149)"/>\n\n            <path class="svg_driver hidden" style="scale:0.8" d="M0,0 L8,3 L11,7 L12,14 L9,24 L12,27 L12,31 L-12,31 L-12,27 L-8,25 L-8,23 L-11,22 L-14,13 L-11,6 L-6,1 Z M-3,7 L-8,11 L-8,17 L-5,20 L1,20 L4,17 L4,10 L-1,7 Z M0,26 L-4,28 L5,28 L3,26 Z " transform="translate(216,105)"/>\n            <path class="svg_moving hidden" d="M0,0 L28,0 L28,4 L0,4 Z " transform="translate(339,119)"/>\n            <path class="svg_moving hidden" d="M0,0 L16,0 L18,2 L17,6 L-2,6 L-3,3 Z " transform="translate(338,130)"/>\n            <path class="svg_moving hidden" d="M0,0 L19,0 L20,4 L19,5 L0,5 L-1,1 Z " transform="translate(330,144)"/>\n\n            <path class="svg_cable hidden" d="M0,0 L9,1 L15,4 L20,9 L23,15 L24,31 L27,40 L34,46 L37,47 L46,47 L53,44 L57,39 L59,32 L59,22 L58,19 L60,15 L66,17 L65,37 L60,47 L51,53 L48,54 L36,54 L26,49 L19,41 L17,37 L17,21 L14,12 L8,8 L0,7 Z " transform="translate(286,119)"/>\n          </svg>\n          <div class="carcard_overlay" id="carcard_status">Loading...</div>\n          <div class="carcard_battery_bar_container">\n            <div class="carcard_battery_bar_background" id="battery_bar"></div>\n            <div class="carcard_battery_bar_text" id="battery_text">0%</div>\n          </div>\n          <div class="carcard_event hidden" id="car_event"></div>\n          <div class="bottom_row">\n            <span class="hidden" id="charger_status"></span>\n            <span class="actions">\n              <button class="charge_button hidden" id="charge_toggle_btn">no action</button>\n            </span>\n          </div>\n        </div>\n    </ha-card>',this.statusEl=this.querySelector("#carcard_status"),this.batteryBar=this.querySelector("#battery_bar"),this.batteryText=this.querySelector("#battery_text"),this.chargeBtn=this.querySelector("#charge_toggle_btn"),this.eventEl=this.querySelector("#car_event"),this.chargerEl=this.querySelector("#charger_status"),this.chargeBtn?.addEventListener("click",(()=>this._handleChargeToggle())),this._displayinsideEl=this.querySelector(".display_inside"),this._car_cableEl=this.querySelector(".svg_cable")}set hass(t){this._hass=t;const e=this.config.charger_connected_entity?t.states[this.config.charger_connected_entity]:void 0,a=this.config.is_charging_entity?t.states[this.config.is_charging_entity]:void 0,n=this.config.car_battery_entity?t.states[this.config.car_battery_entity]:void 0,s=this.config.car_cruising_range_entity?t.states[this.config.car_cruising_range_entity]:void 0,r=this.config.charger_status?t.states[this.config.charger_status]:void 0,i=!(!e||"on"!==e.state),L=r&&r.state?r.state:"";let c;c=a&&void 0!==a.state?"on"===a.state:["Charging Normal","Load Balancing Limited"].includes(L);const{isHome:o,isAway:h,isDriving:d}=this._getLocationBooleans(t,this.config,i);let g="Unknown";const l=!!(this.config.car_charging_start_service&&this.config.car_charging_start_data&&this.config.car_charging_stop_service&&this.config.car_charging_stop_data);if(this._car_cableEl&&this._car_cableEl.classList.toggle("hidden",!i),o?(g="Home",this.querySelectorAll(".svg_charger").forEach((t=>t.classList.remove("hidden"))),i?(g="Connected",this.chargeBtn&&this.chargeBtn.classList.toggle("hidden",!l),this._displayinsideEl&&this._displayinsideEl.classList.toggle("green",c),g=c?"Charging":"Connected"):this.chargeBtn&&this.chargeBtn.classList.add("hidden")):(this.querySelectorAll(".svg_charger").forEach((t=>t.classList.add("hidden"))),this.chargeBtn&&this.chargeBtn.classList.add("hidden")),!o&&h?(g="Parked",this.querySelectorAll(".svg_parking").forEach((t=>t.classList.remove("hidden")))):this.querySelectorAll(".svg_parking").forEach((t=>t.classList.add("hidden"))),o||h||!d?(this.querySelectorAll(".svg_driver").forEach((t=>t.classList.add("hidden"))),this.querySelectorAll(".svg_moving").forEach((t=>t.classList.add("hidden")))):(g="Moving",this.querySelectorAll(".svg_driver").forEach((t=>t.classList.remove("hidden"))),this.querySelectorAll(".svg_moving").forEach((t=>t.classList.remove("hidden")))),this.statusEl&&this._prevStatus!==g&&(this._prevStatus=g,this.statusEl.textContent=g),this._prevIsCharging!==c&&(this._prevIsCharging=c,this.chargeBtn&&(this.chargeBtn.textContent=c?"Stop Charging":"Start Charging")),this.batteryBar&&this.batteryText){const t=n?.state,e=s?.state,a=Number(t),r=Number(e),i=!Number.isNaN(a)&&"number"==typeof a,L=!Number.isNaN(r)&&"number"==typeof r;!i||this._prevBattery===a&&this._prevRange===(L?r:this._prevRange)||(this._prevBattery=a,this._prevRange=L?r:this._prevRange,this.batteryBar.style.width=`${a}%`,this.batteryText.textContent=L?`${a}% (${r} km)`:`${a}%`,this.batteryBar.style.backgroundColor=a>50?"#4CAF50":a>20?"#FF9800":"#F44336")}this.chargerEl&&this._prevChargerStatus!==L&&(this._prevChargerStatus=L,this.chargerEl.classList.remove("hidden"),this.chargerEl.textContent=L||""),!this._carEventFetched&&this.eventEl&&this.config.calendar&&(this._carEventFetched=!0,this.getCarEventToday(t,this.config.calendar).then((()=>{if(this._carEvent&&this.eventEl){this.eventEl.classList.remove("hidden");const t=this._carEvent.summary||"Event",e=this._carEvent.duration||"?";this.eventEl.textContent=`${t} (${e}h)`}})))}async getCarEventToday(t,e){try{if(!e)return;const a=new Date,n=new Date(a);n.setHours(23,59,59);const s=(await t.callApi("GET",`calendar/${e}?start=${a.toISOString()}&end=${n.toISOString()}`)).find((t=>t.start&&t.end));if(s&&s.start&&s.end){const t=new Date(s.start),e=(new Date(s.end).getTime()-t.getTime())/36e5;this._carEvent={...s,duration:e.toFixed(1)}}}catch(t){console.error("Failed to fetch calendar event",t)}}_handleChargeToggle(){if(this._hass)if(this._prevIsCharging)if(this.config.car_charging_stop_service&&this.config.car_charging_stop_data){const[t,e]=this.config.car_charging_stop_service.split(".");this._hass.callService(t,e,this.config.car_charging_stop_data)}else console.warn("car_charging_stop_service or car_charging_stop_data not configured");else if(this.config.car_charging_start_service&&this.config.car_charging_start_data){const[t,e]=this.config.car_charging_start_service.split(".");this._hass.callService(t,e,this.config.car_charging_start_data)}else console.warn("car_charging_start_service or car_charging_start_data not configured");else console.warn("Cannot toggle charging: hass not available")}getCardSize(){return 3}}customElements.define("car-card",t);
